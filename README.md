Модуль MagicSite Integration для Bitrix 
=======================================

# Описание
Модуль предназначен для автоматического встраивания обязательных разделов сайта образовательных организаций, предусмотренных законодательством Российской Федерации, из информационной системы «MagicSite» на сайт под управлением CMS 1С-Битрикс: Управление сайтом.  
Внешний вид сайта, включая меню и инкапсулированные обязательные разделы, устанавливается в CMS 1С-Битрикс: Управление сайтом. Модуль не оказывает влияния на необязательные разделы, которые ведутся на сайте CMS 1С-Битрикс: Управление сайтом.  
При использовании модуля владелец сайта должен завести аккаунт в информационной системе MagicSite и внести в неё данные о своей организации.  
Информационная система «MagicSite» зарегистрирована в РОСПАТЕНТ № 2020662557 от 16 октября 2020 год, включена в Единый реестр российских программ для электронных вычислительных машин и баз данных по Приказу Минцифры России от 15.03.2021 № 151 Приложение № 2, реестровый №9719, совместима со всеми операционными системами, в том числе с операционной системой Альт на платформе х86 и для архитектуры aarch64.  

Информационная система «MagicSite» предусматривает ведение следующих обязательных разделов со своими подраздеоами:

Сведения об образовательной организации;   
Информационная безопасность;  
Противодействие коррупции;  
Независимая оценка качества;  
Педагоги;  
Организация питания.  
Представление на сайте производится в строгом соответствии с законодательством. При изменении законодательства в ИС MagicSite вносятся соответствующие правки, что автоматически находит отражение на сайте пользователя. Пользователь избавлен от необходимости отслеживать требования к сайтам образовательных организаций – достаточно заполнять поля ИС MagicSite. Данные попадают в систему мониторинга сайтов.

# Требования
 1. Версия главного модуля 14.0.0 или выше
 2. Установленные расширения php-curl и php-dom

# Установка
 1. Скачайте ZIP архив плагина https://github.com/e-publish/bitrix-magicsite/raw/master/epublish.magicsite.tar.gz;
 2. Зайдите в административную панель CMS Bitrix вашего сайта;
     > Чтобы войти в административную панель Bitrix, вбейте в адресной строке ссылку http://ваш_сайт/bitrix/, где вместо «ваш_сайт» — доменное имя (адрес) вашего сайта.  
     > Откроется страница с формой для входа в админ-панель.  
 3. Перейдите в раздел "Контент" кликнув по соответствующей иконке в левой колонке;
 4. В разделе "Структура сайта" -> "Файлы и папки" перейдите в папку bitrix/modules;
 5. Нажмите кнопку "Загрузить файл";
 6. В открывшейся форме нажмите кнопку "Добавить файл" в первой строке и выберите скачанный в шаге 1 архив, после чего нажмите кнопку "Применить";
 7. В случае успешной загрузки файла (отсутствие сообщений об ошибке) вернитесь на страницу обзора файлов "Структура сайта" -> "Файлы и папки" -> "bitrix" -> "modules";
 8. Найдите в списке файлов справа загруженный архив. Если вы не видите файл, воспользуйтесь кнопками постраничной навигации, расположенными под таблицей со списком файлов и папок;
 9. Щелкните правой кнопкой мыши на имени файла архива и выберите "Распаковать". В открывшемся окне оставьте все как есть и щелкните по кнопке "Распаковать";
10. Перейдите в раздел "Marketplace" кликнув по соответствующей иконке в левой колонке;
11. Щелкните по ссылке "Установленные решения";
12. Нажмите на иконку слева от строки с описанием модуля "Интеграция с ИC "MagicSite" или кликните правой кнопкой мыши на описании модуля "Интеграция с ИC "MagicSite" и выберите "Установить";
13. Убедитесь, что ваша система отвечает требованиям указанным в разделе "Требования". Если требуется, обновите систему и установите недостающие расширения php;
14. Если на вашем сайте присутствует один или более разделов совпадающий с обязательными разделами сайта образовательной организации, данный раздел будет отмечен в таблице как присутствующий и от вас потребуется согласие на замещение индексного файла данного раздела, файлом модуля интеграции. В этом случае, отметьте чекбокс "Перезаписать существующие разделы";
15. По умолчанию, ссылки на обязательные разделы будут добавлены в верхнее и левое меню сайта. Если вы не хотите добавлять их в данные меню, снимите соответствующие чекбоксы. В дальнейшем, вы сможете добавить ссылки в нужное меню используя средства CMS.
16. Если все условия соблюдены, кнопка "Установить модуль" станет доступна. Щелкните по ней.


# Настройка
После успешной установки модуля необходимо указать адрес сайта в ИС MagicSite данные которого будут отображаться на вашем сайте.  
Перейти в раздел настройки модуль можно щелкнув по кнопке "Настройка" в окне с сообщением об успешной установке модуля или через раздел настроек модулей. Для этого:
 1. Зайдите в административную панель CMS Bitrix вашего сайта;
     > Чтобы войти в административную панель Bitrix, вбейте в адресной строке ссылку http://ваш_сайт/bitrix/, где вместо «ваш_сайт» — доменное имя (адрес) вашего сайта.  
     > Откроется страница с формой для входа в админ-панель.  
 2. Перейдите в раздел "Настройки" кликнув по соответствующей иконке в левой колонке;
 3. Перейдите в раздел "Настройки модулей" -> "Интеграция с ИС MagicSite";
 4. В поле "Адрес сайта в ИС MagicSite" укажите адрес сайта, созданного в виртуальном кабинете MagicSite (https://cp.edusite.ru);
 5. Нажмите кнопку "Сохранить".

# Подключение меню
При установке модуля во всех добавляемых разделах создается файл левого бокового меню .left.menu.php;  
Если при установке вы оставили чекбоксы на пунктах "Добавить ссылки на обязательные разделы сведений в верхнее меню сайта." и/или "Добавить ссылки на обязательные разделы сведений в левое меню сайта." то ссылки на эти разделы были автоматически добавлены в файлы /.top.menu.php и/или /.left.menu.php. В этом случае, дополнительных действий с вашей стороны не требуется.  
Если в корневой директории сайта дынные файлы отсутствуют, то они будут созданы;  
Если в пункте 15 установки вы сняли оба чекбокса и хотите добавить ссылки самостоятельно, то:
 1. Зайдите в административную панель CMS Bitrix вашего сайта;
     > Чтобы войти в административную панель Bitrix, вбейте в адресной строке ссылку http://ваш_сайт/bitrix/, где вместо «ваш_сайт» — доменное имя (адрес) вашего сайта.  
     > Откроется страница с формой для входа в админ-панель.  
 2. Перейдите на вкладку "Сайт";
 3. Включите режим правки (Переключатель расположен справой стороны панели инструментов);
 4. Наведите курсор мышки в верхнюю часть области нужного меню и щелкните по ссылке "Редактировать пункты меню" на всплывшем окне;
 5. Добавьте необходимые пункты меню в соответствии с приведенными ниже данными:  
    Ссылка               Название  
    /sveden/             Сведения об образовательной организации  
    /infosec/            Информационная безопасность  
    /anticorruption/     Противодействие коррупции  
    /qualityassessment/  Независимая оценка качества  
    /distance_education/ Дистанционное обучение  
    /educative/          Воспитательная работа  
    /gia/                Государственная итоговая аттестация  
    /meals/              Организация питания  
    /labor_protection/   Охрана труда  
    /accounting_policy/  Основные положения учетной политики  
 6. Нажмите кнопку "Сохранить";
 7. Нажмите на кнопку "Сбросить кэш" в панели инструментов;
 8. Отключите режим правки.

# Удаление
 1. Зайдите в административную панель CMS Bitrix вашего сайта;
     > Чтобы войти в административную панель Bitrix, вбейте в адресной строке ссылку http://ваш_сайт/bitrix/, где вместо «ваш_сайт» — доменное имя (адрес) вашего сайта.  
     > Откроется страница с формой для входа в админ-панель.  
 2. Перейдите в раздел "Marketplace" кликнув по соответствующей иконке в левой колонке;
 3. Щелкните по ссылке "Установленные решения";
 4. Нажмите на иконку слева от строки с описанием модуля "Интеграция с ИC "MagicSite" или кликните правой кнопкой мыши на описании модуля "Интеграция с ИC "MagicSite" и выберите "Удалить";
 5. Не оправляйте отзыв. Так как модуль не размещался в Bitrix Marketplace, мы его не получим.
 6. Если вы хотите полностью удалить модуль с сайта, нажмите на иконку слева от строки с описанием модуля "Интеграция с ИC "MagicSite" или кликните правой кнопкой мыши на описании модуля "Интеграция с ИC "MagicSite" и выберите "Стереть" и подтвердите действие;
 7. Удалите загруженный файл архива, для чего:
   * Перейдите в раздел "Контент" кликнув по соответствующей иконке в левой колонке;
   * В разделе "Структура сайта" -> "Файлы и папки" перейдите в папку bitrix/modules;
   * Найдите в списке файлов справа файл epublish.magicsite.tar.gz. Если вы не видите файл, воспользуйтесь кнопками постраничной навигации, расположенными под таблицей со списком файлов и папок;
   * Щелкните правой кнопкой мыши на имени файла архива и выберите "Удалить" и подтвердите действие.

